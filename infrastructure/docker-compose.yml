version: '3.8'

services:
  api-gateway:
    build: ./api-gateway
    ports:
      - "8080:8080"
    environment:
      - KAFKA_BROKERS=kafka:9092
    depends_on:
      - kafka

  media-processor:
    build: ./services/media-processor
    deploy:
      replicas: 3
    volumes:
      - ./temp_media:/data/tmp
    environment:
      - STORAGE_PROVIDER=s3
      - KAFKA_TOPIC=media_processing

  ai-engine:
    build: ./services/ai-engine
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    environment:
      - MODEL_PATH=/models/pitch_v1

  kafka:
    image: bitnami/kafka:latest
    ports:
      - "9092:9092"